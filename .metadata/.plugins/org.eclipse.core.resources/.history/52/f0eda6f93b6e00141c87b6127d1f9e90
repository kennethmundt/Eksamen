package dataAccess;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import application.Animal;
import application.Customer;

public class CreateCustomerDb
{
    Connection conn = null;
    PreparedStatement preparedStatement = null;
    ConnectionDb dBc = new ConnectionDb();
    
    public void insertCustomer(Customer customer)
    {
	try
	{
	    String insert = "INSERT INTO kunde VALUES(default, ?, ?, ?, ?)";

	    conn = dBc.getConnection();
	    preparedStatement = conn.prepareStatement(insert, Statement.RETURN_GENERATED_KEYS);

	    preparedStatement.setString(1, customer.getName());
	    preparedStatement.setString(2, customer.getAddress());
	    preparedStatement.setString(3, customer.getPhone());
	    preparedStatement.setString(4, customer.getMail());
	    preparedStatement.executeUpdate();
	}

	catch (SQLException e)
	{
	    System.err.println(e);
	}

	finally
	{
	    if (conn != null)
	    {
		try
		{
		    conn.close();
		} catch (SQLException e)
		{
		    e.printStackTrace();
		}
	    }
	}
    }

    public void insertAnimal(Animal a)
    {
	int customerId = 0;
	customerId = returnLastCustomer();

	try
	{
	    conn = dBc.getConnection();
	    preparedStatement = conn
		    .prepareStatement("INSERT INTO dyr VALUES(default, ?, ?, ?, ?)");

	    preparedStatement.setString(1, a.getAnimalName());
	    preparedStatement.setString(2, a.getAnimalBirth());
	    preparedStatement.setString(3, a.getAnimal());
	    preparedStatement.setInt(4, customerId);

	    preparedStatement.executeUpdate();
	}

	catch (SQLException e)
	{
	    System.err.println(e);
	}

	finally
	{
	    if (conn != null)
	    {
		try
		{
		    conn.close();
		} catch (SQLException e)

		{
		    e.printStackTrace();
		}
	    }
	}
    }

    public int returnLastCustomer()
    {
	int customerId = 0;
	
	try
	{
	    conn = dBc.getConnection();
	    preparedStatement = conn
		    .prepareStatement("SELECT * FROM kunde ORDER BY idkunde DESC LIMIT 1");
	    ResultSet result = preparedStatement.executeQuery();
	    
	    while (result.next())
	    {
		customerId = result.getInt("idkunde");
	    }
	}

	catch (SQLException e)
	{
	    System.err.println(e);
	}

	return customerId;
    }
}
